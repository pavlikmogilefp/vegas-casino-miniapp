<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>VEGAS CASINO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background:
  radial-gradient(circle at 20% 0%, rgba(255,0,255,0.15), transparent 40%),
  radial-gradient(circle at 80% 20%, rgba(0,200,255,0.15), transparent 40%),
  radial-gradient(circle at bottom, #12001f, #050008 60%);
      color: white;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
    }

    .neon {
      box-shadow:
        0 0 10px rgba(255,0,255,0.6),
        0 0 30px rgba(0,150,255,0.4);
    }

    .neon-text {
      text-shadow:
        0 0 10px rgba(255,0,255,0.8),
        0 0 20px rgba(0,150,255,0.6);
    }
    
    /* Neon pulse animation */
@keyframes neonPulse {
  0% { box-shadow: 0 0 12px rgba(255,0,255,0.4), 0 0 24px rgba(0,150,255,0.3); }
  50% { box-shadow: 0 0 24px rgba(255,0,255,0.9), 0 0 48px rgba(0,150,255,0.7); }
  100% { box-shadow: 0 0 12px rgba(255,0,255,0.4), 0 0 24px rgba(0,150,255,0.3); }
}

.neon-animate {
  animation: neonPulse 3s infinite ease-in-out;
}

.card {
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.card:active {
  transform: scale(0.97);
}

/* Screens */
.screen { display: none; }
.screen.active { display: block; animation: screenIn .18s ease-out; }

@keyframes screenIn {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* Coin animation */
/* Better coin animation */
@keyframes coinFlipPro {
  0%   { transform: rotateY(0deg) rotateX(0deg) translateY(0) scale(1); filter: brightness(1); }
  15%  { transform: rotateY(220deg) rotateX(80deg) translateY(-4px) scale(1.06); filter: brightness(1.15); }
  35%  { transform: rotateY(520deg) rotateX(160deg) translateY(-8px) scale(1.10); filter: brightness(1.25); }
  60%  { transform: rotateY(900deg) rotateX(260deg) translateY(-4px) scale(1.06); filter: brightness(1.18); }
  85%  { transform: rotateY(1200deg) rotateX(340deg) translateY(0) scale(1.02); filter: brightness(1.08); }
  100% { transform: rotateY(1440deg) rotateX(360deg) translateY(0) scale(1); filter: brightness(1); }
}

.coin-anim {
  animation: coinFlipPro 1.05s cubic-bezier(.2,.9,.15,1);
  transform-style: preserve-3d;
  will-change: transform, filter;
  backface-visibility: hidden;
}

@keyframes floatUp {
  0%   { opacity: 0; transform: translateY(10px) scale(.95); }
  20%  { opacity: 1; transform: translateY(0) scale(1); }
  80%  { opacity: 1; transform: translateY(-12px) scale(1); }
  100% { opacity: 0; transform: translateY(-22px) scale(1.02); }
}

.float-anim { animation: floatUp 1.1s ease-in-out; }

.pick {
  position: relative;
  transition: transform .15s ease, filter .15s ease, opacity .15s ease;
}

.pick:not(.active-pick) {
  opacity: .75;
  filter: saturate(.85);
}

.active-pick {
  opacity: 1;
  filter: saturate(1.2) brightness(1.1);
  box-shadow: 0 0 14px rgba(255,0,255,.45), 0 0 34px rgba(0,200,255,.25);
}

.pick:active { transform: scale(.98); }

@keyframes winGlow {
  0%   { transform: scale(1); filter: brightness(1) saturate(1); box-shadow: 0 0 0 rgba(0,0,0,0); }
  25%  { transform: scale(1.08); filter: brightness(1.35) saturate(1.4); box-shadow: 0 0 24px rgba(80,255,170,.65), 0 0 60px rgba(0,200,255,.35); }
  60%  { transform: scale(1.03); filter: brightness(1.2) saturate(1.25); box-shadow: 0 0 18px rgba(80,255,170,.5), 0 0 44px rgba(255,0,255,.25); }
  100% { transform: scale(1); filter: brightness(1) saturate(1); box-shadow: 0 0 0 rgba(0,0,0,0); }
}

@keyframes loseShake {
  0% { transform: translateX(0); }
  20% { transform: translateX(-4px); }
  40% { transform: translateX(4px); }
  60% { transform: translateX(-3px); }
  80% { transform: translateX(3px); }
  100% { transform: translateX(0); }
}

.win-pop { animation: winGlow .55s ease-out; }
.lose-shake { animation: loseShake .35s ease-in-out; }

/* Screen flash */
@keyframes screenPulseWin {
  0% { opacity: 0; transform: scale(1); }
  15% { opacity: .55; transform: scale(1.02); }
  100% { opacity: 0; transform: scale(1.06); }
}

@keyframes screenPulseLose {
  0% { opacity: 0; }
  20% { opacity: .35; }
  100% { opacity: 0; }
}

.pulse-win { animation: screenPulseWin .55s ease-out; }
.pulse-lose { animation: screenPulseLose .35s ease-out; }

.particle {
  position: absolute;
  width: 8px;
  height: 8px;
  border-radius: 9999px;
  opacity: 0.95;
  filter: blur(.2px);
}

@keyframes particleFly {
  0%   { transform: translate(0,0) scale(1); opacity: 1; }
  100% { transform: translate(var(--dx), var(--dy)) scale(.2); opacity: 0; }
}

.mcell{
  height: 56px;
  border-radius: 16px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight: 800;
  user-select:none;
  transition: transform .12s ease, background .12s ease, box-shadow .12s ease, border-color .12s ease;
}
.mcell:active{ transform: scale(.98); }

.mcell.open{
  background: rgba(255,255,255,0.10);
  border-color: rgba(0,200,255,0.25);
  box-shadow: 0 0 14px rgba(0,200,255,0.18);
}

.mcell.safe{
  background: linear-gradient(135deg, rgba(0,210,255,0.18), rgba(255,0,255,0.10));
  border-color: rgba(255,0,255,0.25);
  box-shadow: 0 0 18px rgba(255,0,255,0.18), 0 0 26px rgba(0,210,255,0.12);
}

.mcell.mine{
  background: linear-gradient(135deg, rgba(255,60,120,0.22), rgba(255,180,0,0.10));
  border-color: rgba(255,60,120,0.35);
  box-shadow: 0 0 22px rgba(255,60,120,0.22);
}

/* Mines FX */
@keyframes gemPop {
  0%   { transform: scale(.85); filter: brightness(1); }
  40%  { transform: scale(1.15); filter: brightness(1.35); }
  100% { transform: scale(1); filter: brightness(1); }
}
.gem-pop { animation: gemPop .22s ease-out; }

@keyframes mineBoom {
  0%   { transform: scale(1); filter: brightness(1); }
  20%  { transform: scale(1.08); filter: brightness(1.3); }
  100% { transform: scale(1); filter: brightness(1); }
}
.mine-boom { animation: mineBoom .25s ease-out; }

@keyframes screenRedFlash {
  0% { opacity: 0; }
  20% { opacity: .45; }
  100% { opacity: 0; }
}
.mines-flash { animation: screenRedFlash .35s ease-out; }

@keyframes screenBlueFlash {
  0% { opacity: 0; }
  25% { opacity: .35; }
  100% { opacity: 0; }
}
.mines-flash-win { animation: screenBlueFlash .35s ease-out; }

.mines-pulse-layer{
  pointer-events:none;
  position: fixed;
  inset: 0;
  opacity: 0;
}

.slots-reel{
  height: 82px;
  border-radius: 18px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

.slots-symbol{
  font-size: 46px;
  line-height: 1;
  transform: translateY(0);
  will-change: transform, filter;
}

@keyframes reelSpin {
  0%   { transform: translateY(0); filter: blur(0); }
  20%  { transform: translateY(-140px); filter: blur(1.5px); }
  60%  { transform: translateY(140px); filter: blur(2px); }
  100% { transform: translateY(0); filter: blur(0); }
}

.reel-spin { animation: reelSpin .55s ease-in-out; }

@keyframes slotsWinPop {
  0% { transform: scale(1); filter: brightness(1); }
  35% { transform: scale(1.12); filter: brightness(1.35); }
  100% { transform: scale(1); filter: brightness(1); }
}
.slots-win { animation: slotsWinPop .45s ease-out; }

/* –ø—Ä–∏—è—Ç–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞—Ä–∞–±–∞–Ω–∞ */
@keyframes reelStopBounce {
  0%   { transform: scale(1); filter: blur(0); }
  35%  { transform: scale(1.08); filter: blur(.2px); }
  100% { transform: scale(1); filter: blur(0); }
}
.reel-stop { animation: reelStopBounce .22s ease-out; }

/* WIN highlight –≤–æ–∫—Ä—É–≥ –ª–∏–Ω–∏–∏ —Å–ª–æ—Ç–æ–≤ (—É—Å–∏–ª–µ–Ω–Ω—ã–π, –≤—Å–µ–≥–¥–∞ –≤–∏–¥–µ–Ω) */
@keyframes lineWinGlow {
  0%   { opacity: 0; transform: scale(.995); filter: blur(2px); }
  35%  { opacity: 1; transform: scale(1.01); filter: blur(0px); }
  100% { opacity: 0; transform: scale(1.02); filter: blur(2px); }
}

.slots-line{
  position: relative;
  border-radius: 20px;
  overflow: visible; /* –≤–∞–∂–Ω–æ */
}

.slots-line::after{
  content:"";
  position:absolute;
  inset:-4px;               /* —á—É—Ç—å —Å–Ω–∞—Ä—É–∂–∏ –±–ª–æ–∫–∞ */
  border-radius: 24px;
  pointer-events:none;
  opacity:0;
  z-index: 5;

  /* ‚Äú–Ω–µ–æ–Ω–æ–≤–∞—è —Ä–∞–º–∫–∞‚Äù */
  border: 2px solid rgba(80,255,170,.35);
  box-shadow:
    0 0 14px rgba(80,255,170,.55),
    0 0 36px rgba(0,210,255,.35),
    0 0 70px rgba(255,0,255,.18);
}

.slots-line-win::after{
  animation: lineWinGlow .65s ease-out;
}

.slots-line-lose::after{
  opacity: 1;
  border-color: rgba(255,80,120,.35);
  box-shadow:
    0 0 14px rgba(255,80,120,.45),
    0 0 34px rgba(255,180,0,.18);
}

  </style>
</head>

<body class="min-h-screen bg-black text-white">

<!-- FIXED HEADER -->
<div class="fixed top-0 left-0 right-0 z-50 px-4 py-3
            bg-black/70 backdrop-blur-xl border-b border-white/10">

  <div class="flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 neon"></div>
      <div>
        <div class="text-sm font-bold leading-none">–ò–≥—Ä–æ–∫</div>
        <div class="text-xs text-purple-300">LVL 1 ¬∑ 0 XP</div>
      </div>
    </div>

<div class="px-5 py-2 rounded-xl
            bg-gradient-to-r from-cyan-400 via-purple-500 to-pink-500
            neon neon-animate font-bold text-sm">
  <span id="balance-header">5 000 ‚ÇΩ</span>
</div>
  </div>

</div>

  <!-- GAMES -->
<!-- SCREENS WRAPPER -->
<div class="pt-24 px-4 pb-32">

 <!-- HOME SCREEN -->
<div id="screen-home" class="screen active space-y-4">

  <div id="go-slots" class="card p-4 rounded-2xl bg-gradient-to-br from-cyan-500 to-blue-600 neon neon-animate">
    <h3 class="font-bold">–°–ª–æ—Ç—ã</h3>
    <p class="text-sm opacity-80">–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞</p>
  </div>

  <div id="go-mines" class="card p-5 rounded-2xl bg-gradient-to-r from-purple-600 to-pink-500 neon neon-animate">
    <h2 class="text-xl font-bold neon-text">Mines</h2>
    <p class="text-sm opacity-80">–ù–∞–π–¥–∏—Ç–µ –∞–ª–º–∞–∑—ã, –∏–∑–±–µ–≥–∞—è –º–∏–Ω</p>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div class="card p-4 rounded-2xl bg-gradient-to-br from-pink-500 to-purple-700 neon neon-animate">
      <h3 class="font-bold">–ö–µ–π—Å—ã</h3>
      <p class="text-sm opacity-80">–ü—Ä–∏–∑—ã</p>
    </div>
  </div>

  <div id="go-coinflip" class="card p-4 rounded-2xl bg-gradient-to-r from-yellow-400 to-orange-500 neon text-black font-bold">
    –û—Ä—ë–ª –∏–ª–∏ –†–µ—à–∫–∞
  </div>

</div>

<!-- COINFLIP GAME SCREEN -->
<div id="screen-coinflip" class="screen space-y-4">
  <div class="text-xl font-bold neon-text mb-2">ü™ô –û—Ä—ë–ª –∏–ª–∏ –†–µ—à–∫–∞</div>

<!-- screen pulse overlay -->
<div id="cf-pulse" class="pointer-events-none fixed inset-0 opacity-0"></div>
<div id="cf-particles" class="pointer-events-none fixed inset-0"></div>

<!-- Coin display -->
<div class="card p-5 rounded-2xl bg-black/30 border border-white/10">
  <div class="text-sm text-white/60 mb-3">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>

  <div class="flex items-center justify-center">
  <div class="w-28 h-28 rounded-full neon bg-black/20 flex items-center justify-center">
    <img id="coin-img"
         src="assets/coin-heads.PNG"
         class="w-28 h-28 rounded-full select-none"
         alt="coin" />
  </div>
</div>

  <div id="coin-sub" class="text-center text-xs text-white/50 mt-3">
    –ù–∞–∂–º–∏ ¬´–ü–æ–¥–±—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç—É¬ª
  </div>
</div>

<!-- Floating win/lose -->
<div id="cf-float" class="pointer-events-none fixed left-0 right-0 top-20 flex justify-center opacity-0">
  <div id="cf-float-inner" class="px-4 py-2 rounded-2xl font-extrabold neon">
    +0 ‚ÇΩ
  </div>
</div>
  <div class="card p-5 rounded-2xl bg-white/5 border border-white/10">
    <div class="text-sm text-white/70 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–æ—Ä–æ–Ω—É</div>

    <div class="grid grid-cols-2 gap-3">
<button id="cf-heads" class="pick py-4 rounded-2xl bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold neon active:scale-[0.98] transition">
  –û–†–Å–õ ¬∑ 1.96x
</button>
      <button id="cf-tails" class="pick py-4 rounded-2xl bg-gradient-to-r from-cyan-400 to-purple-600 text-black font-bold neon active:scale-[0.98] transition">
  –†–ï–®–ö–ê ¬∑ 1.96x
</button>
    </div>

    <div class="mt-4">
      <div class="text-sm text-white/70 mb-2">–°—Ç–∞–≤–∫–∞</div>

      <div class="flex items-center gap-3">
        <button id="cf-minus" class="w-12 h-12 rounded-xl bg-black/40 border border-white/10 text-xl">‚àí</button>

        <div class="flex-1 text-center">
          <div id="cf-bet" class="text-2xl font-extrabold">10 ‚ÇΩ</div>
          <div class="text-xs text-white/50">min 10 ‚ÇΩ</div>
        </div>

        <button id="cf-plus" class="w-12 h-12 rounded-xl bg-black/40 border border-white/10 text-xl">+</button>
      </div>

      <div class="grid grid-cols-5 gap-2 mt-3">
        <button class="cf-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="10">10</button>
        <button class="cf-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="50">50</button>
        <button class="cf-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="100">100</button>
        <button class="cf-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="250">250</button>
        <button class="cf-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="MAX">MAX</button>
      </div>

      <button id="cf-play" class="mt-4 w-full py-4 rounded-2xl bg-gradient-to-r from-pink-500 to-purple-700 neon neon-animate font-extrabold active:scale-[0.98] transition">
        –ü–û–î–ë–†–û–°–ò–¢–¨ –ú–û–ù–ï–¢–£
      </button>
    </div>
  </div>

<div class="flex justify-between text-xs text-white/50 mt-2">
  <div>–®–∞–Ω—Å: 50%</div>
  <div>–í—ã–ø–ª–∞—Ç–∞: 1.96x</div>
</div>

  <div id="cf-message" class="text-sm text-white/60">–í—ã–±–µ—Ä–∏ —Å—Ç–æ—Ä–æ–Ω—É –∏ —Å–¥–µ–ª–∞–π —Å—Ç–∞–≤–∫—É.</div>

  <button id="cf-back" class="w-full py-3 rounded-2xl bg-black/40 border border-white/10">
    ‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é
  </button>
</div>

<!-- MINES SCREEN -->
<div id="screen-mines" class="screen space-y-4">
<div class="text-xl font-bold neon-text mb-2">üíé Mines</div>
<div id="mines-pulse" class="mines-pulse-layer"></div>

  <div class="card p-5 rounded-2xl bg-white/5 border border-white/10 space-y-4">
    <div class="grid grid-cols-2 gap-3">
      <div class="bg-black/30 border border-white/10 rounded-2xl p-4">
        <div class="text-xs text-white/50">–°—Ç–∞–≤–∫–∞</div>
        <div id="mines-bet" class="text-2xl font-extrabold mt-1">10 ‚ÇΩ</div>
        <div class="flex gap-2 mt-3">
          <button id="mines-bet-minus" class="flex-1 py-2 rounded-xl bg-black/40 border border-white/10">‚àí</button>
          <button id="mines-bet-plus" class="flex-1 py-2 rounded-xl bg-black/40 border border-white/10">+</button>
        </div>
      </div>

      <div class="bg-black/30 border border-white/10 rounded-2xl p-4">
        <div class="text-xs text-white/50">–ú–∏–Ω—ã</div>
        <div id="mines-count" class="text-2xl font-extrabold mt-1">3</div>
        <input id="mines-slider" type="range" min="1" max="10" value="3" class="w-full mt-3">
        <div class="text-xs text-white/50 mt-1">–ë–æ–ª—å—à–µ –º–∏–Ω ‚Üí –±–æ–ª—å—à–µ –º–Ω–æ–∂–∏—Ç–µ–ª—å</div>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-3">
      <button id="mines-start" class="py-4 rounded-2xl bg-gradient-to-r from-pink-500 to-purple-700 neon neon-animate font-extrabold active:scale-[0.98] transition">
        –ù–ê–ß–ê–¢–¨
      </button>
      <button id="mines-cashout" class="py-4 rounded-2xl bg-black/40 border border-white/10 font-extrabold opacity-60" disabled>
        –ó–ê–ë–†–ê–¢–¨
      </button>
    </div>

    <div class="flex items-center justify-between text-sm">
      <div class="text-white/60">–ú–Ω–æ–∂–∏—Ç–µ–ª—å</div>
      <div id="mines-mult" class="font-extrabold neon-text">1.00x</div>
    </div>

    <div class="text-sm text-white/60">
      –û—Ç–∫—Ä–æ–π –∞–ª–º–∞–∑—ã. –ü–æ–ø–∞–¥—ë—à—å –Ω–∞ –º–∏–Ω—É ‚Äî –ø—Ä–æ–∏–≥—Ä–∞–ª —Å—Ç–∞–≤–∫—É.
    </div>
  </div>
  <div class="card p-4 rounded-2xl bg-black/30 border border-white/10">
  <div class="flex items-center justify-between mb-3">
    <div class="font-bold">–¢–∞–±–ª–∏—Ü–∞</div>
    <div class="text-xs text-white/50">–û—Ç–∫—Ä—ã—Ç–æ / –ú–Ω–æ–∂–∏—Ç–µ–ª—å / –í—ã–ø–ª–∞—Ç–∞</div>
  </div>

  <div id="mines-table" class="space-y-2"></div>
</div>

  <div class="card p-4 rounded-2xl bg-black/30 border border-white/10">
    <div id="mines-grid" class="grid grid-cols-5 gap-2"></div>
  </div>

  <div id="mines-msg" class="text-sm text-white/60">–í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É –∏ –Ω–∞–∂–º–∏ ¬´–ù–ê–ß–ê–¢–¨¬ª.</div>

  <button id="mines-back" class="w-full py-3 rounded-2xl bg-black/40 border border-white/10">
    ‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é
  </button>
</div>

<!-- SLOTS SCREEN (–≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞) -->
<div id="screen-slots" class="screen space-y-4">
  <div class="text-xl font-bold neon-text mb-2">üé∞ –°–ª–æ—Ç—ã</div>

  <div id="pick-slots-classic"
       class="card p-5 rounded-2xl bg-gradient-to-r from-cyan-500 to-purple-600 neon neon-animate">
    <div class="flex items-center justify-between">
      <div>
        <div class="font-bold text-lg">–°–ª–æ—Ç—ã</div>
        <div class="text-sm opacity-80">3 –±–∞—Ä–∞–±–∞–Ω–∞ ¬∑ 1 –ª–∏–Ω–∏—è</div>
      </div>
      <div class="text-sm opacity-80">–¥–æ 25x</div>
    </div>
  </div>

  <div id="pick-slots-mega"
       class="card p-5 rounded-2xl bg-gradient-to-r from-purple-600 to-pink-500 neon neon-animate">
    <div class="flex items-center justify-between">
      <div>
        <div class="font-bold text-lg">–ú–µ–≥–∞-—Å–ª–æ—Ç—ã</div>
        <div class="text-sm opacity-80">–±–æ–ª—å—à–µ –ª–∏–Ω–∏–π ¬∑ –≤—ã—à–µ —à–∞–Ω—Å</div>
      </div>
      <div class="text-sm opacity-80">–¥–æ 250x</div>
    </div>
  </div>

  <button id="slots-back" class="w-full py-3 rounded-2xl bg-black/40 border border-white/10">
    ‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é
  </button>
</div>

<!-- CLASSIC SLOTS GAME SCREEN -->
<div id="screen-slots-classic" class="screen space-y-4">
  <div class="text-xl font-bold neon-text mb-2">üé∞ –°–ª–æ—Ç—ã</div>

  <div class="card p-5 rounded-2xl bg-black/30 border border-white/10 space-y-4">
    <div class="flex items-center justify-between">
      <div>
        <div class="text-sm text-white/60">–õ–∏–Ω–∏—è</div>
        <div class="font-extrabold">3 –±–∞—Ä–∞–±–∞–Ω–∞ ¬∑ 1 –ª–∏–Ω–∏—è</div>
      </div>
      <div class="text-right">
        <div class="text-sm text-white/60">–ú–∞–∫—Å –≤—ã–∏–≥—Ä—ã—à</div>
        <div class="font-extrabold neon-text">–¥–æ 25x</div>
      </div>
    </div>

<div id="slots-line" class="slots-line rounded-2xl bg-black/40 border border-white/10 p-4">
      <div id="slots-reels" class="grid grid-cols-3 gap-3 text-center select-none">
        <div class="slots-reel"><div class="slots-symbol" data-i="0">üçí</div></div>
        <div class="slots-reel"><div class="slots-symbol" data-i="1">üçã</div></div>
        <div class="slots-reel"><div class="slots-symbol" data-i="2">üçá</div></div>
      </div>
      <div class="mt-3 text-center text-xs text-white/50">–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ 3 —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ –ª–∏–Ω–∏–∏</div>
    </div>

    <div class="grid grid-cols-3 gap-3">
      <button id="slots-minus" class="py-3 rounded-2xl bg-black/40 border border-white/10 text-xl">‚àí</button>

      <div class="text-center">
        <div class="text-xs text-white/60">–°—Ç–∞–≤–∫–∞</div>
        <div id="slots-bet" class="text-2xl font-extrabold">10 ‚ÇΩ</div>
      </div>

      <button id="slots-plus" class="py-3 rounded-2xl bg-black/40 border border-white/10 text-xl">+</button>
    </div>

    <div class="grid grid-cols-5 gap-2">
      <button class="slots-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="10">10</button>
      <button class="slots-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="50">50</button>
      <button class="slots-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="100">100</button>
      <button class="slots-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="250">250</button>
      <button class="slots-quick py-2 rounded-xl bg-black/40 border border-white/10 text-sm" data-v="MAX">MAX</button>
    </div>

    <button id="slots-spin" class="w-full py-4 rounded-2xl bg-gradient-to-r from-pink-500 to-purple-700 neon neon-animate font-extrabold active:scale-[0.98] transition">
      –ö–†–£–¢–ò–¢–¨
    </button>

    <div id="slots-msg" class="text-sm text-white/60">–ù–∞–∂–º–∏ ¬´–ö–†–£–¢–ò–¢–¨¬ª.</div>
  </div>

<!-- PAYTABLE -->
<div class="card p-5 rounded-2xl bg-black/30 border border-white/10 space-y-3">
  <div class="flex items-center justify-between">
    <div class="font-bold">–¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç</div>
    <div class="text-xs text-white/50">3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–æ –ª–∏–Ω–∏–∏</div>
  </div>

  <div id="slots-paytable" class="space-y-2"></div>

  <div class="text-xs text-white/50 pt-2 border-t border-white/10">
    –í—ã–ø–ª–∞—Ç–∞ = —Å—Ç–∞–≤–∫–∞ √ó –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
  </div>
</div>

  <button id="slots-classic-back" class="w-full py-3 rounded-2xl bg-black/40 border border-white/10">
    ‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É
  </button>
</div>

<!-- MEGA SLOTS SCREEN -->
<div id="screen-slots-mega" class="screen space-y-4">
  <div class="text-xl font-bold neon-text mb-2">üî• –ú–µ–≥–∞-—Å–ª–æ—Ç—ã</div>

  <div class="card p-5 rounded-2xl bg-gradient-to-r from-purple-600 to-pink-500 neon neon-animate">
    <div class="font-bold text-lg">–°–∫–æ—Ä–æ</div>
    <div class="text-sm opacity-80">–î–æ–±–∞–≤–∏–º –ª–∏–Ω–∏–∏, –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã.</div>
  </div>

  <button id="slots-mega-back" class="w-full py-3 rounded-2xl bg-black/40 border border-white/10">
    ‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É
  </button>
</div>

  <!-- WALLET SCREEN -->
  <div id="screen-wallet" class="screen space-y-4">
    <div class="text-xl font-bold neon-text mb-2">üíº –ö–æ—à–µ–ª—ë–∫</div>

    <div class="card p-5 rounded-2xl bg-gradient-to-r from-purple-600 to-cyan-500 neon neon-animate">
      <div class="text-sm text-white/70">–ë–∞–ª–∞–Ω—Å</div>
<div id="balance-wallet" class="text-3xl font-extrabold">5 000 ‚ÇΩ</div>
      <div class="text-xs text-white/60 mt-1">–ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ ¬∑ –±–µ–∑ –≤—ã–≤–æ–¥–∞</div>
    </div>

    <div class="card p-4 rounded-2xl bg-white/5 border border-white/10">
  <div class="font-bold mb-2">–ò—Å—Ç–æ—Ä–∏—è</div>
  <div id="history-list" class="text-sm text-white/70 space-y-2">
    <div class="text-white/50">–ü–æ–∫–∞ –ø—É—Å—Ç–æ ‚Äî —Å—ã–≥—Ä–∞–π –ø–µ—Ä–≤—É—é –∏–≥—Ä—É üôÇ</div>
  </div>
</div>
  </div>

  <!-- BONUSES / PROMO SCREEN -->
<div id="screen-bonuses" class="screen space-y-4">
  <div class="text-xl font-bold neon-text mb-2">üéü –ü—Ä–æ–º–æ–∫–æ–¥</div>

  <div class="card p-5 rounded-2xl bg-gradient-to-r from-pink-500 to-purple-700 neon neon-animate">
    <div class="font-bold text-lg">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥</div>
    <div class="text-sm opacity-80">–ü—Ä–æ–º–æ–∫–æ–¥—ã –¥–∞—é—Ç –∏–≥—Ä–æ–≤—É—é –≤–∞–ª—é—Ç—É ‚ÇΩ</div>

    <input
      id="promo-input"
      placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: VEGAS250"
      class="mt-4 w-full px-4 py-3 rounded-xl
             bg-black/40 border border-white/10
             outline-none text-white placeholder:text-white/40"
    />

    <button
      id="promo-apply"
      class="mt-3 w-full py-3 rounded-xl
             bg-black/50 border border-white/10 font-bold
             active:scale-[0.98] transition"
    >
      –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
    </button>
  </div>

  <!-- –º–µ—Å—Ç–æ –¥–ª—è —Ç–µ–∫—Å—Ç–∞/—Å–æ–æ–±—â–µ–Ω–∏–π -->
  <div id="promo-message" class="text-sm text-white/60">
    –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞).
  </div>
</div>
</div>

<!-- BOTTOM MENU -->
<div class="fixed bottom-0 left-0 right-0 z-50
            bg-black/80 backdrop-blur-xl
            border-t border-white/10
            flex justify-around py-3">

  <button id="tab-home" class="tab flex flex-col items-center text-cyan-400 neon-text text-sm">
    üè† <span class="text-xs">–ì–ª–∞–≤–Ω–∞—è</span>
  </button>

  <button id="tab-slots" class="tab flex flex-col items-center text-gray-500 text-sm">
    üé∞ <span class="text-xs">–°–ª–æ—Ç—ã</span>
  </button>

  <button id="tab-wallet" class="tab flex flex-col items-center text-gray-500 text-sm">
    üíº <span class="text-xs">–ö–æ—à–µ–ª—ë–∫</span>
  </button>

  <button id="tab-bonuses" class="tab flex flex-col items-center text-gray-500 text-sm">
    üéÅ <span class="text-xs">–ë–æ–Ω—É—Å—ã</span>
  </button>

</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand(); // —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

  // Navigation
  const screens = {
    home: document.getElementById('screen-home'),
    slots: document.getElementById('screen-slots'),
    slotsClassic: document.getElementById('screen-slots-classic'),// –∏–≥—Ä–∞
  slotsMega: document.getElementById('screen-slots-mega'),      // –º–µ–≥–∞
    wallet: document.getElementById('screen-wallet'),
    bonuses: document.getElementById('screen-bonuses'),
    coinflip: document.getElementById('screen-coinflip'), // ‚Üê –¥–æ–±–∞–≤—å
    mines: document.getElementById('screen-mines'),
  };

  const tabs = {
    home: document.getElementById('tab-home'),
    slots: document.getElementById('tab-slots'),
    wallet: document.getElementById('tab-wallet'),
    bonuses: document.getElementById('tab-bonuses'),
  };

  // ===== Wallet state (local) =====
  const DEFAULT_BALANCE = 5000;

  function formatRUB(n) {
    return n.toLocaleString('ru-RU') + ' ‚ÇΩ';
  }

  function getBalance() {
    const raw = localStorage.getItem('vegas_balance');
    const val = raw ? parseInt(raw, 10) : DEFAULT_BALANCE;
    return Number.isFinite(val) ? val : DEFAULT_BALANCE;
  }

  function setBalance(newValue) {
    const val = Math.max(0, Math.floor(newValue));
    localStorage.setItem('vegas_balance', String(val));
    renderBalance();
  }

  function renderBalance() {
    const b = getBalance();
    const headerEl = document.getElementById('balance-header');
    const walletEl = document.getElementById('balance-wallet');

    if (headerEl) headerEl.textContent = formatRUB(b);
    if (walletEl) walletEl.textContent = formatRUB(b);
  }

  // –ø—Ä–æ–º–æ–∫–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ (–ª–æ–∫–∞–ª—å–Ω–æ)
  function getUsedPromos() {
    try {
      return JSON.parse(localStorage.getItem('vegas_used_promos') || '[]');
    } catch {
      return [];
    }
  }

  function addUsedPromo(code) {
    const used = getUsedPromos();
    if (!used.includes(code)) used.push(code);
    localStorage.setItem('vegas_used_promos', JSON.stringify(used));
  }

  // —Ä–∏—Å—É–µ–º –±–∞–ª–∞–Ω—Å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
  renderBalance();

  function setActive(name) {
    Object.entries(screens).forEach(([key, el]) => {
if (el) el.classList.toggle('active', key === name);
    });

const tabName = (name === 'slotsClassic' || name === 'slotsMega') ? 'slots' : name;

Object.entries(tabs).forEach(([key, btn]) => {
  if (key === tabName) {
    btn.classList.remove('text-gray-500');
    btn.classList.add('text-cyan-400', 'neon-text');
  } else {
    btn.classList.remove('text-cyan-400', 'neon-text');
    btn.classList.add('text-gray-500');
  }
});

if (name === 'mines' && typeof minesResetUI === 'function') {
  minesResetUI();
}

    // –ª—ë–≥–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è
    if (window.Telegram?.WebApp?.HapticFeedback) {
      Telegram.WebApp.HapticFeedback.impactOccurred('light');
    }
  }

  tabs.home.addEventListener('click', () => setActive('home'));
  tabs.slots.addEventListener('click', () => setActive('slots'));
  tabs.wallet.addEventListener('click', () => setActive('wallet'));
  tabs.bonuses.addEventListener('click', () => setActive('bonuses'));

  // –æ—Ç–∫–ª—é—á–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
  document.body.style.userSelect = 'none';
  
  document.querySelectorAll('.card').forEach(card => {
  card.addEventListener('click', () => {
    if (window.Telegram?.WebApp?.HapticFeedback) {
      Telegram.WebApp.HapticFeedback.impactOccurred('light');
    }
  });
});
  
    // Promo (front-only demo)
  const promoInput = document.getElementById('promo-input');
  const promoApply = document.getElementById('promo-apply');
  const promoMessage = document.getElementById('promo-message');

  if (promoApply) {
    promoApply.addEventListener('click', () => {
      const code = (promoInput.value || '').trim().toUpperCase();

      if (!code) {
        promoMessage.textContent = '–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥.';
        return;
      }

            const used = getUsedPromos();
      if (used.includes(code)) {
        promoMessage.textContent = '‚ö†Ô∏è –≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.';
        if (window.Telegram?.WebApp?.HapticFeedback) {
          Telegram.WebApp.HapticFeedback.notificationOccurred('error');
        }
        return;
      }

      // –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (–ø–æ–∫–∞ —Ç—É—Ç, –ø–æ—Ç–æ–º –ø–µ—Ä–µ–Ω–µ—Å—ë–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
      const promoMap = {
        'VEGAS250': 250,
        'VEGAS1000': 1000,
        'WELCOME100': 100,
      };

      const amount = promoMap[code];

      if (!amount) {
        promoMessage.textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥.';
        if (window.Telegram?.WebApp?.HapticFeedback) {
          Telegram.WebApp.HapticFeedback.notificationOccurred('error');
        }
        return;
      }

      // –Ω–∞—á–∏—Å–ª—è–µ–º
      const newBalance = getBalance() + amount;
      setBalance(newBalance);
      addUsedPromo(code);

      promoMessage.textContent = `‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –ù–∞—á–∏—Å–ª–µ–Ω–æ +${amount} ‚ÇΩ`;
      promoInput.value = '';

      if (window.Telegram?.WebApp?.HapticFeedback) {
        Telegram.WebApp.HapticFeedback.notificationOccurred('success');
      }
    });
  }
  
  // ===== Coinflip navigation =====
const goCoinflip = document.getElementById('go-coinflip');
const cfBack = document.getElementById('cf-back');

if (goCoinflip) goCoinflip.addEventListener('click', () => setActive('coinflip'));
if (cfBack) cfBack.addEventListener('click', () => setActive('home'));
  
  // ===== Slots navigation =====
const goSlots = document.getElementById('go-slots');
const slotsBack = document.getElementById('slots-back');

if (goSlots) goSlots.addEventListener('click', () => setActive('slots'));
if (slotsBack) slotsBack.addEventListener('click', () => setActive('home'));

// ===== Slots mode picker =====
const pickClassic = document.getElementById('pick-slots-classic');
const pickMega = document.getElementById('pick-slots-mega');
const backClassic = document.getElementById('slots-classic-back');
const backMega = document.getElementById('slots-mega-back');

if (pickClassic) pickClassic.addEventListener('click', () => setActive('slotsClassic'));
if (pickMega) pickMega.addEventListener('click', () => setActive('slotsMega'));

if (backClassic) backClassic.addEventListener('click', () => setActive('slots'));
if (backMega) backMega.addEventListener('click', () => setActive('slots'));
  
  // ===== Mines navigation =====
const goMines = document.getElementById('go-mines');
const minesBack = document.getElementById('mines-back');

if (goMines) goMines.addEventListener('click', () => setActive('mines'));
if (minesBack) minesBack.addEventListener('click', () => setActive('home'));
  
  // ===== MINES GAME =====
const minesGrid = document.getElementById('mines-grid');
const minesMsg = document.getElementById('mines-msg');
const minesPulse = document.getElementById('mines-pulse');
const minesTable = document.getElementById('mines-table');

const minesBetEl = document.getElementById('mines-bet');
const minesBetMinus = document.getElementById('mines-bet-minus');
const minesBetPlus  = document.getElementById('mines-bet-plus');

const minesSlider = document.getElementById('mines-slider');
const minesCountEl = document.getElementById('mines-count');
const minesMultEl = document.getElementById('mines-mult');

const minesStart = document.getElementById('mines-start');
const minesCashout = document.getElementById('mines-cashout');

let minesBet = 10;
let minesCount = 3;

let minesActive = false;
let minesOpened = 0;
let minesSet = new Set();     // –∏–Ω–¥–µ–∫—Å—ã –º–∏–Ω
let minesOpenSet = new Set(); // –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–ª–µ—Ç–∫–∏
let minesBaseBet = 0;         // —Å—Ç–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã

const GRID_SIZE = 25; // 5x5

function minesFormat() {
  if (minesBetEl) minesBetEl.textContent = formatRUB(minesBet);
  if (minesCountEl) minesCountEl.textContent = String(minesCount);
}

function minesFlash(isWin) {
  if (!minesPulse) return;

  minesPulse.className = 'mines-pulse-layer';
  minesPulse.style.background = isWin
    ? 'radial-gradient(circle at 50% 35%, rgba(0,210,255,.22), rgba(0,0,0,0) 55%)'
    : 'radial-gradient(circle at 50% 35%, rgba(255,60,120,.22), rgba(0,0,0,0) 55%)';

  void minesPulse.offsetWidth; // restart
  minesPulse.classList.add(isWin ? 'mines-flash-win' : 'mines-flash');
}

function minesRenderTable() {
  if (!minesTable) return;

  const safeCells = GRID_SIZE - minesCount;
  const rows = [];

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 6 —Å—Ç—Ä–æ–∫: —Ç–µ–∫—É—â—É—é –∏ —Å–ª–µ–¥—É—é—â–∏–µ
  const start = Math.max(0, minesOpened - 1);
  const end = Math.min(safeCells, start + 6);

  for (let opened = start; opened <= end; opened++) {
    // –≤—Ä–µ–º–µ–Ω–Ω–æ "—Å–∏–º—É–ª–∏—Ä—É–µ–º" –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è —Å—Ç—Ä–æ–∫–∏
    const tmpOpened = minesOpened;
    minesOpened = opened;
    const mult = minesSetMultiplier();
    minesOpened = tmpOpened;

    const payout = minesActive
      ? Math.floor(minesBaseBet * mult)
      : Math.floor(minesBet * mult);

    const isCurrent = opened === minesOpened;

    rows.push(`
      <div class="flex items-center justify-between rounded-xl px-3 py-2 border border-white/10 ${isCurrent ? 'bg-white/10 neon' : 'bg-black/20'}">
        <div class="text-sm font-bold">${opened} –æ—Ç–∫—Ä—ã—Ç–æ</div>
        <div class="text-sm neon-text">${mult.toFixed(2)}x</div>
        <div class="text-sm font-extrabold">${payout.toLocaleString('ru-RU')} ‚ÇΩ</div>
      </div>
    `);
  }

  // –µ—Å–ª–∏ –µ—â—ë –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∞
  if (minesOpened === 0) {
    minesTable.innerHTML = `
      <div class="text-sm text-white/60">
        –û—Ç–∫—Ä–æ–π –ø–µ—Ä–≤—É—é –∫–ª–µ—Ç–∫—É ‚Äî –ø–æ—è–≤–∏—Ç—Å—è —Ä–∞—Å—á—ë—Ç –≤—ã–ø–ª–∞—Ç.
      </div>
    `;
    return;
  }

  minesTable.innerHTML = rows.join('');
}

function popAnim(el, cls) {
  if (!el) return;
  el.classList.remove(cls);
  void el.offsetWidth;
  el.classList.add(cls);
}

function minesSetMultiplier() {
  // –ø—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å: —á–µ–º –±–æ–ª—å—à–µ –æ—Ç–∫—Ä—ã—Ç–æ –∏ —á–µ–º –±–æ–ª—å—à–µ –º–∏–Ω ‚Äî —Ç–µ–º –≤—ã—à–µ
  const safeCells = GRID_SIZE - minesCount;
  const progress = safeCells ? (minesOpened / safeCells) : 0;

  // –±–∞–∑–æ–≤—ã–π —Ä–æ—Å—Ç
  const m = 1 + (minesOpened * (0.12 + minesCount * 0.015));

  // —á—É—Ç—å —É—Å–∏–ª–∏–º –Ω–∞ –ø–æ–∑–¥–Ω–∏—Ö —Å—Ç–∞–¥–∏—è—Ö
  const boost = 1 + progress * 0.35;

  const mult = Math.max(1, m * boost);
  if (minesMultEl) minesMultEl.textContent = mult.toFixed(2) + 'x';
  return mult;
}

function minesEnableCashout(enable) {
  if (!minesCashout) return;

  minesCashout.disabled = !enable;
  minesCashout.classList.toggle('opacity-60', !enable);

  if (enable) {
    minesCashout.classList.add('neon','neon-animate');
    minesCashout.classList.remove('bg-black/40');
    minesCashout.classList.add('bg-gradient-to-r','from-cyan-400','to-purple-600','text-black');
  } else {
    minesCashout.classList.remove('neon','neon-animate','bg-gradient-to-r','from-cyan-400','to-purple-600','text-black');
    minesCashout.classList.add('bg-black/40');
  }
}

function minesResetUI() {
  minesOpened = 0;
  minesOpenSet.clear();
  minesSet.clear();
  minesActive = false;
  minesBaseBet = 0;

  minesEnableCashout(false);
  if (minesMultEl) minesMultEl.textContent = '1.00x';
  if (minesMsg) minesMsg.textContent = '–í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É –∏ –Ω–∞–∂–º–∏ ¬´–ù–ê–ß–ê–¢–¨¬ª.';
  minesRenderGrid(true);
}

function minesRenderGrid(empty = false) {
  if (!minesGrid) return;
  minesGrid.innerHTML = '';

  for (let i = 0; i < GRID_SIZE; i++) {
    const cell = document.createElement('button');
    cell.className = 'mcell';
    cell.dataset.i = String(i);

    if (empty) {
      cell.disabled = true;
      cell.style.opacity = '0.9';
    } else {
      cell.disabled = !minesActive;
      cell.addEventListener('click', () => minesOpenCell(i, cell));
    }

    minesGrid.appendChild(cell);
  }
}

function minesPlaceMines() {
  minesSet.clear();
  while (minesSet.size < minesCount) {
    const idx = Math.floor(Math.random() * GRID_SIZE);
    minesSet.add(idx);
  }
}

function minesStartGame() {
  if (minesActive) return;

  const bal = getBalance();
  if (minesBet > bal) {
    if (minesMsg) minesMsg.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ.';
    if (window.Telegram?.WebApp?.HapticFeedback) Telegram.WebApp.HapticFeedback.notificationOccurred('error');
    return;
  }

  // —Å–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
  setBalance(bal - minesBet);
  minesBaseBet = minesBet;

  minesActive = true;
  minesOpened = 0;
  minesOpenSet.clear();
  minesPlaceMines();

  minesEnableCashout(false);
  minesSetMultiplier();
  minesRenderTable();
  if (minesMsg) minesMsg.textContent = '–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –û—Ç–∫—Ä—ã–≤–∞–π –∫–ª–µ—Ç–∫–∏ üíé';

  minesRenderGrid(false);

  if (window.Telegram?.WebApp?.HapticFeedback) Telegram.WebApp.HapticFeedback.notificationOccurred('success');
}

function minesRevealAll() {
  if (!minesGrid) return;
  [...minesGrid.children].forEach((el, idx) => {
    const cell = el;
    const isMine = minesSet.has(idx);
    if (isMine) {
      cell.classList.add('mine', 'open');
      cell.textContent = 'üí£';
    } else if (minesOpenSet.has(idx)) {
      cell.classList.add('safe', 'open');
      cell.textContent = 'üíé';
    } else {
      cell.classList.add('open');
      cell.textContent = '';
    }
    cell.disabled = true;
  });
}

function minesOpenCell(i, cellEl) {
  if (!minesActive) return;
  if (minesOpenSet.has(i)) return;

  minesOpenSet.add(i);

  if (minesSet.has(i)) {
    // üí£ –ø—Ä–æ–∏–≥—Ä—ã—à
    minesActive = false;
    minesEnableCashout(false);

    cellEl.classList.add('mine', 'open');
    cellEl.textContent = 'üí£';
    popAnim(cellEl, 'mine-boom');
minesFlash(false);

    minesRevealAll();

    if (minesMsg) minesMsg.textContent = 'üí• –ë—É–º! –¢—ã –ø–æ–ø–∞–ª –Ω–∞ –º–∏–Ω—É. –°—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–Ω–∞.';
    addHistory({
      game: 'Mines',
      bet: minesBaseBet,
      delta: -minesBaseBet,
      time: new Date().toLocaleString('ru-RU'),
    });

    if (window.Telegram?.WebApp?.HapticFeedback) Telegram.WebApp.HapticFeedback.notificationOccurred('error');
    return;
  }

  // üíé –±–µ–∑–æ–ø–∞—Å–Ω–æ
  minesOpened++;
  cellEl.classList.add('safe', 'open');
  cellEl.textContent = 'üíé';
  popAnim(cellEl, 'gem-pop');

  const mult = minesSetMultiplier();
  minesRenderTable();

  minesEnableCashout(true);
  if (minesMsg) minesMsg.textContent = `üíé –£–¥–∞—á–Ω–æ! –û—Ç–∫—Ä—ã—Ç–æ: ${minesOpened}. –ú–Ω–æ–∂–∏—Ç–µ–ª—å: ${mult.toFixed(2)}x`;

  if (window.Telegram?.WebApp?.HapticFeedback) Telegram.WebApp.HapticFeedback.impactOccurred('light');
}

function minesCashoutNow() {
  if (!minesActive) return;
  if (minesOpened <= 0) {
    if (minesMsg) minesMsg.textContent = '–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–ª–µ—Ç–∫—É üôÇ';
    if (window.Telegram?.WebApp?.HapticFeedback) Telegram.WebApp.HapticFeedback.notificationOccurred('error');
    return;
  }

  minesActive = false;
  minesEnableCashout(false);

  const mult = minesSetMultiplier();
  const payout = Math.floor(minesBaseBet * mult);

  setBalance(getBalance() + payout);
  minesFlash(true);

  if (minesMsg) minesMsg.textContent = `‚úÖ –¢—ã –∑–∞–±—Ä–∞–ª: +${payout.toLocaleString('ru-RU')} ‚ÇΩ (${mult.toFixed(2)}x)`;
  minesRenderTable();

  addHistory({
    game: 'Mines',
    bet: minesBaseBet,
    delta: payout - minesBaseBet,
    time: new Date().toLocaleString('ru-RU'),
  });

  minesRevealAll();

  if (window.Telegram?.WebApp?.HapticFeedback) Telegram.WebApp.HapticFeedback.notificationOccurred('success');
}

// controls
if (minesSlider) {
  minesSlider.addEventListener('input', () => {
    minesCount = parseInt(minesSlider.value, 10);
    minesFormat();
    minesSetMultiplier();
    minesRenderTable();
  });
}

if (minesBetMinus) minesBetMinus.addEventListener('click', () => {
  if (minesActive) return;
  minesBet = Math.max(10, minesBet - 10);
  minesFormat();
});

if (minesBetPlus) minesBetPlus.addEventListener('click', () => {
  if (minesActive) return;
  minesBet = Math.min(100000, minesBet + 10);
  minesFormat();
  minesRenderTable();
});

if (minesStart) minesStart.addEventListener('click', minesStartGame);
if (minesCashout) minesCashout.addEventListener('click', minesCashoutNow);

// init
minesFormat();
minesResetUI();
minesRenderTable();
  
  // ===== History (local) =====
function getHistory() {
  try {
    return JSON.parse(localStorage.getItem('vegas_history') || '[]');
  } catch {
    return [];
  }
}

function addHistory(item) {
  const list = getHistory();
  list.unshift(item); // –Ω–æ–≤–æ–µ —Å–≤–µ—Ä—Ö—É
  localStorage.setItem('vegas_history', JSON.stringify(list.slice(0, 30))); // –º–∞–∫—Å–∏–º—É–º 30
  renderHistory();
}

function renderHistory() {
  const el = document.getElementById('history-list');
  if (!el) return;

  const list = getHistory();
  if (!list.length) {
    el.innerHTML = `<div class="text-white/50">–ü–æ–∫–∞ –ø—É—Å—Ç–æ ‚Äî —Å—ã–≥—Ä–∞–π –ø–µ—Ä–≤—É—é –∏–≥—Ä—É üôÇ</div>`;
    return;
  }

  el.innerHTML = list.map(h => {
    const sign = h.delta >= 0 ? '+' : '‚àí';
    const abs = Math.abs(h.delta);
    const color = h.delta >= 0 ? 'text-green-300' : 'text-red-300';
    return `
      <div class="flex items-center justify-between bg-black/30 border border-white/10 rounded-xl px-3 py-2">
        <div>
          <div class="font-semibold">${h.game}</div>
          <div class="text-xs text-white/50">${h.time}</div>
        </div>
        <div class="text-right">
          <div class="${color} font-bold">${sign}${abs.toLocaleString('ru-RU')} ‚ÇΩ</div>
          <div class="text-xs text-white/50">—Å—Ç–∞–≤–∫–∞ ${h.bet.toLocaleString('ru-RU')} ‚ÇΩ</div>
        </div>
      </div>
    `;
  }).join('');
}

// –†–∏—Å—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
renderHistory();


// ===== Coinflip game =====
const CF_MULT = 1.96;
let cfSide = null; // 'heads' | 'tails'
let cfBet = 10;

const cfHeads = document.getElementById('cf-heads');
const cfTails = document.getElementById('cf-tails');
const cfMinus = document.getElementById('cf-minus');
const cfPlus  = document.getElementById('cf-plus');
const cfBetEl = document.getElementById('cf-bet');
const cfPlay  = document.getElementById('cf-play');
const cfMsg   = document.getElementById('cf-message');
const coinImg = document.getElementById('coin-img');
const COIN_HEADS_SRC = 'assets/coin-heads.PNG';
const COIN_TAILS_SRC = 'assets/coin-tails.PNG';

let flickerTimer = null;

function startCoinFlicker() {
  if (!coinImg) return;
  stopCoinFlicker();
  let t = 0;
  flickerTimer = setInterval(() => {
    // ‚Äú–º–∏–≥–∞–Ω–∏–µ‚Äù + —á—É—Ç—å —É—Å–∫–æ—Ä—è–µ–º
    coinImg.src = (t % 2 === 0) ? COIN_HEADS_SRC : COIN_TAILS_SRC;
    t++;
  }, 80);
}

function stopCoinFlicker() {
  if (flickerTimer) {
    clearInterval(flickerTimer);
    flickerTimer = null;
  }
}
const coinSub = document.getElementById('coin-sub');
const cfFloat = document.getElementById('cf-float');
const cfFloatInner = document.getElementById('cf-float-inner');

function cfFormatBet() {
  if (cfBetEl) cfBetEl.textContent = formatRUB(cfBet);
}

function cfSetSide(side) {
  cfSide = side;

  // –∫—Ä–∞—Å–∏–≤—ã–µ —Ç–∞–±—ã
  if (cfHeads) cfHeads.classList.toggle('active-pick', side === 'heads');
  if (cfTails) cfTails.classList.toggle('active-pick', side === 'tails');

  // —É–±—Ä–∞—Ç—å —Å—Ç–∞—Ä—ã–µ ring-—Å—Ç–∏–ª–∏ (–µ—Å–ª–∏ –±—ã–ª–∏)
  if (cfHeads) { cfHeads.classList.remove('ring-2','ring-white/50'); }
  if (cfTails) { cfTails.classList.remove('ring-2','ring-white/50'); }

  // —Ç–µ–∫—Å—Ç
  if (cfMsg) cfMsg.textContent = side === 'heads' ? '–í—ã–±—Ä–∞–Ω: –û—Ä—ë–ª' : '–í—ã–±—Ä–∞–Ω–∞: –†–µ—à–∫–∞';

  // –ø—Ä–µ–≤—å—é –º–æ–Ω–µ—Ç—ã (—Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É)
  if (coinImg && !flickerTimer) {
    coinImg.src = (side === 'heads') ? COIN_HEADS_SRC : COIN_TAILS_SRC;
  }
  if (coinSub && !flickerTimer) {
    coinSub.textContent = side === 'heads' ? '–í—ã –≤—ã–±—Ä–∞–ª–∏ –û—Ä—ë–ª' : '–í—ã –≤—ã–±—Ä–∞–ª–∏ –†–µ—à–∫—É';
  }

  // –ª—ë–≥–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è
  if (window.Telegram?.WebApp?.HapticFeedback) {
    Telegram.WebApp.HapticFeedback.selectionChanged();
  }
}

if (cfHeads) cfHeads.addEventListener('click', () => cfSetSide('heads'));
if (cfTails) cfTails.addEventListener('click', () => cfSetSide('tails'));

if (cfMinus) cfMinus.addEventListener('click', () => {
  cfBet = Math.max(10, cfBet - 10);
  cfFormatBet();
});

if (cfPlus) cfPlus.addEventListener('click', () => {
  cfBet = Math.min(100000, cfBet + 10);
  cfFormatBet();
});

document.querySelectorAll('.cf-quick').forEach(btn => {
  btn.addEventListener('click', () => {
    const v = btn.getAttribute('data-v');
    if (v === 'MAX') {
      cfBet = Math.max(10, getBalance());
    } else {
      cfBet = Math.max(10, parseInt(v, 10));
    }
    cfFormatBet();
  });
});

cfFormatBet();
// –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–±–æ—Ä–∞
if (cfHeads) cfHeads.classList.remove('active-pick');
if (cfTails) cfTails.classList.remove('active-pick');

// –∞–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
function cfSetPlaying(isPlaying) {
  if (!cfPlay) return;
  cfPlay.disabled = isPlaying;
  cfPlay.style.opacity = isPlaying ? '0.7' : '1';
  cfPlay.textContent = isPlaying ? '–ö–†–£–¢–ò–ú...' : '–ü–û–î–ë–†–û–°–ò–¢–¨ –ú–û–ù–ï–¢–£';
}

function showFloat(text, isWin) {
  if (!cfFloat || !cfFloatInner) return;

  cfFloatInner.textContent = text;
  cfFloatInner.className = "px-4 py-2 rounded-2xl font-extrabold neon " + (isWin ? "bg-green-400 text-black" : "bg-red-400 text-black");

  cfFloat.classList.remove('opacity-0');
  cfFloat.classList.remove('float-anim'); // —Å–±—Ä–æ—Å
  void cfFloat.offsetWidth; // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
  cfFloat.classList.add('float-anim');

  setTimeout(() => {
    cfFloat.classList.add('opacity-0');
  }, 1100);
}

const cfPulse = document.getElementById('cf-pulse');

function pulseScreen(isWin) {
  if (!cfPulse) return;

  cfPulse.className = 'pointer-events-none fixed inset-0 opacity-0';
  cfPulse.style.background = isWin
    ? 'radial-gradient(circle at 50% 40%, rgba(80,255,170,.22), rgba(0,0,0,0) 55%)'
    : 'radial-gradient(circle at 50% 40%, rgba(255,80,120,.18), rgba(0,0,0,0) 55%)';

  // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
  void cfPulse.offsetWidth;
  cfPulse.classList.add(isWin ? 'pulse-win' : 'pulse-lose');
}

// —Å–∞–º –±—Ä–æ—Å–æ–∫
if (cfPlay) {
  cfPlay.addEventListener('click', () => {
    if (!cfSide) {
      if (cfMsg) cfMsg.textContent = '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Å—Ç–æ—Ä–æ–Ω—É üôÇ';
      if (window.Telegram?.WebApp?.HapticFeedback) {
        Telegram.WebApp.HapticFeedback.notificationOccurred('error');
      }
      return;
    }

    const bal = getBalance();
    if (cfBet > bal) {
      if (cfMsg) cfMsg.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ.';
      if (window.Telegram?.WebApp?.HapticFeedback) {
        Telegram.WebApp.HapticFeedback.notificationOccurred('error');
      }
      return;
    }

    // —Å–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É —Å—Ä–∞–∑—É
    setBalance(bal - cfBet);
    cfSetPlaying(true);

    if (cfMsg) cfMsg.textContent = '–ü–æ–¥–±—Ä–∞—Å—ã–≤–∞–µ–º –º–æ–Ω–µ—Ç—É...';
    // —Å—Ç–∞—Ä—Ç –∞–Ω–∏–º–∞—Ü–∏–∏ –º–æ–Ω–µ—Ç—ã
    if (coinImg) {
  coinImg.classList.remove('coin-anim');
  void coinImg.offsetWidth;
  coinImg.classList.add('coin-anim');
}
startCoinFlicker();
    if (coinSub) coinSub.textContent = '–ö—Ä—É—Ç–∏–º...';

    // "—Å–ª—É—á–∞–π–Ω–∞—è" —Å—Ç–æ—Ä–æ–Ω–∞
    const result = Math.random() < 0.5 ? 'heads' : 'tails';

    // –Ω–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –¥–ª—è –æ—â—É—â–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
      const win = (result === cfSide);
      // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–ø–∞–≤—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –Ω–∞ –º–æ–Ω–µ—Ç–∫–µ
stopCoinFlicker();
if (window.Telegram?.WebApp?.HapticFeedback) {
  Telegram.WebApp.HapticFeedback.impactOccurred('medium');
}
if (coinImg) {
  coinImg.src = (result === 'heads') ? COIN_HEADS_SRC : COIN_TAILS_SRC;
}
      if (coinSub) coinSub.textContent = (result === 'heads') ? '–í—ã–ø–∞–ª –û—Ä—ë–ª' : '–í—ã–ø–∞–ª–∞ –†–µ—à–∫–∞';

      if (win) {
        const payout = Math.floor(cfBet * CF_MULT); // –æ–∫—Ä—É–≥–ª—è–µ–º –≤–Ω–∏–∑
        setBalance(getBalance() + payout);

        if (cfMsg) cfMsg.textContent = `‚úÖ –ü–æ–±–µ–¥–∞! –í—ã–ø–∞–ª–æ: ${result === 'heads' ? '–û—Ä—ë–ª' : '–†–µ—à–∫–∞'} ¬∑ +${payout} ‚ÇΩ`;
showFloat(`+${payout.toLocaleString('ru-RU')} ‚ÇΩ`, true);
        pulseScreen(true);
        spawnWinParticles();
if (coinImg) {
  coinImg.classList.remove('win-pop');
  void coinImg.offsetWidth;
  coinImg.classList.add('win-pop');
}
if (window.Telegram?.WebApp?.HapticFeedback) {
  Telegram.WebApp.HapticFeedback.notificationOccurred('success');
  Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
}
        addHistory({
          game: '–û—Ä—ë–ª / –†–µ—à–∫–∞',
          bet: cfBet,
          delta: payout - cfBet, // —á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å
          time: new Date().toLocaleString('ru-RU'),
        });

        if (window.Telegram?.WebApp?.HapticFeedback) {
          Telegram.WebApp.HapticFeedback.notificationOccurred('success');
        }
      } else {
        if (cfMsg) cfMsg.textContent = `‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à. –í—ã–ø–∞–ª–æ: ${result === 'heads' ? '–û—Ä—ë–ª' : '–†–µ—à–∫–∞'}`;
        showFloat(`‚àí${cfBet.toLocaleString('ru-RU')} ‚ÇΩ`, false);
       pulseScreen(false);
if (coinImg) {
  coinImg.classList.remove('lose-shake');
  void coinImg.offsetWidth;
  coinImg.classList.add('lose-shake');
}
if (window.Telegram?.WebApp?.HapticFeedback) {
  Telegram.WebApp.HapticFeedback.notificationOccurred('error');
}
         addHistory({
          game: '–û—Ä—ë–ª / –†–µ—à–∫–∞',
          bet: cfBet,
          delta: -cfBet,
          time: new Date().toLocaleString('ru-RU'),
        });

        if (window.Telegram?.WebApp?.HapticFeedback) {
          Telegram.WebApp.HapticFeedback.notificationOccurred('error');
        }
      }

      cfSetPlaying(false);
      renderBalance();
    }, 900);
  });
}
  
  const cfParticles = document.getElementById('cf-particles');

function spawnWinParticles() {
  if (!cfParticles) return;

  // —Ü–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–º –≥–¥–µ –º–æ–Ω–µ—Ç–∞)
  const cx = window.innerWidth / 2;
  const cy = window.innerHeight * 0.33;

  const count = 22;

  for (let i = 0; i < count; i++) {
    const p = document.createElement('div');
    p.className = 'particle';

    // —Å–ª—É—á–∞–π–Ω—ã–π –Ω–µ–æ–Ω-—Ü–≤–µ—Ç (—Ä–æ–∑–æ–≤—ã–π/—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π/–≥–æ–ª—É–±–æ–π/–∑–µ–ª—ë–Ω—ã–π)
    const colors = [
      'rgba(255,0,255,0.95)',
      'rgba(160,80,255,0.95)',
      'rgba(0,210,255,0.95)',
      'rgba(80,255,170,0.95)'
    ];
    const c = colors[Math.floor(Math.random() * colors.length)];
    p.style.background = c;
    p.style.boxShadow = `0 0 10px ${c}, 0 0 22px ${c}`;

    // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
    p.style.left = cx + 'px';
    p.style.top = cy + 'px';

    // —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è
    const angle = (Math.PI * 2) * (i / count) + (Math.random() * 0.25);
    const dist = 120 + Math.random() * 110;
    const dx = Math.cos(angle) * dist;
    const dy = Math.sin(angle) * dist + (Math.random() * 40);

    p.style.setProperty('--dx', dx.toFixed(0) + 'px');
    p.style.setProperty('--dy', dy.toFixed(0) + 'px');

    // –∞–Ω–∏–º–∞—Ü–∏—è
    const dur = 520 + Math.random() * 260;
    p.style.animation = `particleFly ${dur}ms ease-out forwards`;

    cfParticles.appendChild(p);

    // —É–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ
    setTimeout(() => p.remove(), dur + 50);
  }
}
  
  // ===== SLOTS GAME =====
const SLOTS = {
  symbols: ['üçí','üçã','üçá','‚≠êÔ∏è','7Ô∏è‚É£','üíé'],
  pays: { 'üçí':2, 'üçã':3, 'üçá':4, '‚≠êÔ∏è':6, '7Ô∏è‚É£':10, 'üíé':25 },
  // –≤–µ—Å–∞ (—á—Ç–æ–±—ã –¥–æ—Ä–æ–≥–∏–µ –≤—ã–ø–∞–¥–∞–ª–∏ —Ä–µ–∂–µ)
  weights: { 'üçí':30, 'üçã':24, 'üçá':18, '‚≠êÔ∏è':12, '7Ô∏è‚É£':7, 'üíé':3 }
};

let slotsBet = 10;
let slotsSpinning = false;

const slotsBetEl = document.getElementById('slots-bet');
const slotsMinus = document.getElementById('slots-minus');
const slotsPlus  = document.getElementById('slots-plus');
const slotsSpin  = document.getElementById('slots-spin');
const slotsMsg   = document.getElementById('slots-msg');
const slotsSymbols = [
  document.querySelector('.slots-symbol[data-i="0"]'),
  document.querySelector('.slots-symbol[data-i="1"]'),
  document.querySelector('.slots-symbol[data-i="2"]'),
];

function slotsFormatBet(){
  if (slotsBetEl) slotsBetEl.textContent = formatRUB(slotsBet);
}

function weightedPick(){
  const entries = Object.entries(SLOTS.weights);
  let total = 0;
  for (const [,w] of entries) total += w;
  let r = Math.random() * total;
  for (const [sym,w] of entries){
    r -= w;
    if (r <= 0) return sym;
  }
  return 'üçí';
}

function slotsSetSpinning(on){
  slotsSpinning = on;
  if (!slotsSpin) return;
  slotsSpin.disabled = on;
  slotsSpin.style.opacity = on ? '0.7' : '1';
  slotsSpin.textContent = on ? '–ö–†–£–¢–ò–ú...' : '–ö–†–£–¢–ò–¢–¨';
}

function pop(el, cls){
  if (!el) return;
  el.classList.remove(cls);
  void el.offsetWidth;
  el.classList.add(cls);
}

function slotsLineFlash(isWin){
  const box = document.getElementById('slots-line');
  if (!box) return;

  box.classList.remove('slots-line-win','slots-line-lose');

  // –¥–≤–æ–π–Ω–æ–π reflow ‚Äî –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –∏–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
  void box.offsetWidth;
  void box.offsetHeight;

  box.classList.add(isWin ? 'slots-line-win' : 'slots-line-lose');

  if (!isWin) {
    setTimeout(() => box.classList.remove('slots-line-lose'), 420);
  }
}

// paytable
function slotsRenderPaytable(){
  const box = document.getElementById('slots-paytable');
  if (!box) return;

  const rows = Object.entries(SLOTS.pays)
    .sort((a,b) => b[1] - a[1])
    .map(([sym, mult]) => `
      <div class="flex items-center justify-between px-3 py-2 rounded-xl bg-white/5 border border-white/10">
        <div class="flex items-center gap-2">
          <div class="text-2xl">${sym}</div>
          <div class="text-sm text-white/70">√ó3 –ø–æ –ª–∏–Ω–∏–∏</div>
        </div>
        <div class="font-extrabold neon-text">${mult}x</div>
      </div>
    `);

  box.innerHTML = rows.join('');
}

// —Ä–∏—Å—É–µ–º –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
slotsRenderPaytable();

if (slotsMinus) slotsMinus.addEventListener('click', () => {
  if (slotsSpinning) return;
  slotsBet = Math.max(10, slotsBet - 10);
  slotsFormatBet();
});

if (slotsPlus) slotsPlus.addEventListener('click', () => {
  if (slotsSpinning) return;
  slotsBet = Math.min(100000, slotsBet + 10);
  slotsFormatBet();
});

document.querySelectorAll('.slots-quick').forEach(btn => {
  btn.addEventListener('click', () => {
    if (slotsSpinning) return;
    const v = btn.getAttribute('data-v');
    if (v === 'MAX') slotsBet = Math.max(10, getBalance());
    else slotsBet = Math.max(10, parseInt(v, 10));
    slotsFormatBet();
  });
});

slotsFormatBet();

if (slotsSpin) {
  slotsSpin.addEventListener('click', () => {
    if (slotsSpinning) return;

    const bal = getBalance();
    if (slotsBet > bal) {
      if (slotsMsg) slotsMsg.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤.';
      if (window.Telegram?.WebApp?.HapticFeedback) Telegram.WebApp.HapticFeedback.notificationOccurred('error');
      return;
    }

    // —Å–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
    setBalance(bal - slotsBet);
    slotsSetSpinning(true);
    if (slotsMsg) slotsMsg.textContent = '–ö—Ä—É—Ç–∏–º –±–∞—Ä–∞–±–∞–Ω—ã...';

    // –º–∏–≥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ (–ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ–º—É —Ç–∞–π–º–µ—Ä—É –Ω–∞ –±–∞—Ä–∞–±–∞–Ω)
    const tempTimer = [];
    for (let i = 0; i < 3; i++){
      const el = slotsSymbols[i];
      if (!el) continue;

      el.classList.remove('reel-spin');
      void el.offsetWidth;
      el.classList.add('reel-spin');

      const t = setInterval(() => {
        el.textContent = SLOTS.symbols[Math.floor(Math.random()*SLOTS.symbols.length)];
      }, 60);

      tempTimer[i] = t;
    }

    // —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    const result = [weightedPick(), weightedPick(), weightedPick()];

    // –ø–æ–æ—á–µ—Ä–µ–¥–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
    const stops = [650, 900, 1150]; // 1-–π, 2-–π, 3-–π

    stops.forEach((ms, idx) => {
      setTimeout(() => {
        // –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∏–≥–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —ç—Ç–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
        if (tempTimer[idx]) clearInterval(tempTimer[idx]);

        // –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–≤–æ–ª
        if (slotsSymbols[idx]) {
          slotsSymbols[idx].textContent = result[idx];
          slotsSymbols[idx].classList.remove('reel-stop');
          void slotsSymbols[idx].offsetWidth;
          slotsSymbols[idx].classList.add('reel-stop');
        }

        // –≤–∏–±—Ä–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —Å—Ç–æ–ø–µ
        if (window.Telegram?.WebApp?.HapticFeedback) {
          Telegram.WebApp.HapticFeedback.impactOccurred('light');
        }

        // –ø–æ—Å–ª–µ 3-–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞ ‚Äî —Å—á–∏—Ç–∞–µ–º –∏—Ç–æ–≥
        if (idx === 2) {
          const win = (result[0] === result[1] && result[1] === result[2]);

          if (win) {
            const mult = SLOTS.pays[result[0]] || 0;
            const payout = Math.floor(slotsBet * mult);

            setBalance(getBalance() + payout);

            for (let i = 0; i < 3; i++) pop(slotsSymbols[i], 'slots-win');
            slotsLineFlash(true);
            
            if (slotsMsg) slotsMsg.textContent =
              `‚úÖ WIN! ${result.join(' ')} ¬∑ +${payout.toLocaleString('ru-RU')} ‚ÇΩ (${mult}x)`;
            
            addHistory({
              game: '–°–ª–æ—Ç—ã',
              bet: slotsBet,
              delta: payout - slotsBet,
              time: new Date().toLocaleString('ru-RU'),
            });

            if (window.Telegram?.WebApp?.HapticFeedback) {
              Telegram.WebApp.HapticFeedback.notificationOccurred('success');
              Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
            }
          } else {
            slotsLineFlash(false);
            if (slotsMsg) slotsMsg.textContent = `‚ùå –ú–∏–º–æ: ${result.join(' ')}`;
            
            
            addHistory({
              game: '–°–ª–æ—Ç—ã',
              bet: slotsBet,
              delta: -slotsBet,
              time: new Date().toLocaleString('ru-RU'),
            });

            if (window.Telegram?.WebApp?.HapticFeedback) {
              Telegram.WebApp.HapticFeedback.notificationOccurred('error');
            }
          }

          slotsSetSpinning(false);
          renderBalance();
        }
      }, ms);
    });
  });
}
  
</script>

</body>
</html>
